{% extends "base.html" %}
{% block content %}

<div class="container-fluid">
  <div class="row mb-3">
    <div class="col-md-8">
      <h3><i class="material-icons">schedule</i> 전략 스케줄</h3>
    </div>
    <div class="col-md-4 text-right">
      <button id="save_btn" class="btn btn-primary"><i class="material-icons">save</i> 저장</button>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-striped">
          <thead class="thead-dark">
            <tr>
              <th>전략</th>
              <th>CRON</th>
              <th>활성</th>
            </tr>
          </thead>
          <tbody>
            {% for s in arg.strategies %}
            <tr>
              <td>{{ s.name }} <span class="small text-muted">({{ s.id }})</span></td>
              <td style="max-width:300px;">
                <input type="text" class="form-control form-control-sm" id="cron_{{ s.id }}" value="{{ arg.current_schedule[s.id].cron if s.id in arg.current_schedule else '' }}" placeholder="예: 0 9 * * 1-5">
              </td>
              <td>
                <input type="checkbox" id="enabled_{{ s.id }}" {% if s.id in arg.current_schedule and arg.current_schedule[s.id].enabled %}checked{% endif %}>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
$('#save_btn').on('click', function(){
  var data = {};
  {% for s in arg.strategies %}
  data['cron_{{ s.id }}'] = $('#cron_{{ s.id }}').val();
  data['enabled_{{ s.id }}'] = $('#enabled_{{ s.id }}').is(':checked') ? 'on' : '';
  {% endfor %}
  $.ajax({
    url: '/7split_checklist_21/api/screening/schedule_save',
    type: 'POST',
    data: data,
    success: function(res){
      if (res.ret === 'success') notify(res.msg, 'success');
      else notify(res.msg || '저장 실패', 'error');
    },
    error: function(){ notify('요청 실패', 'error'); }
  });
});
</script>

{% endblock %}


