{% extends "base.html" %}
{% block content %}

<div class="container-fluid">
    {% if error %}
    <div class="alert alert-danger">
        <strong>오류:</strong> {{ error }}
    </div>
    {% elif result %}
    <div class="row mb-3">
        <div class="col-md-12">
            <h3>
                <i class="material-icons">assessment</i> 
                {{ result.name }} ({{ result.code }})
                <span class="badge badge-{% if result.market == 'KOSPI' %}primary{% else %}info{% endif %} ml-2">
                    {{ result.market }}
                </span>
            </h3>
            <p class="text-muted">
                최근 스크리닝: {{ result.screening_date }} (전략: {{ result.strategy_name }})
            </p>
        </div>
    </div>

    <div class="card mb-3">
        <div class="card-header">
            <strong>최신 스크리닝 상세 정보</strong>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <ul class="list-group">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            시가총액
                            <span>{{ (result.market_cap / 100000000)|int|format_number }}억</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            거래대금
                            <span>{{ (result.trading_value / 100000000)|int|format_number }}억</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            통과 여부
                            {% if result.passed %}
                            <span class="badge badge-success">통과</span>
                            {% else %}
                            <span class="badge badge-secondary">미통과</span>
                            {% endif %}
                        </li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <ul class="list-group">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            PER
                            <span>{{ "%.2f".format(result.per if result.per else 0) }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            PBR
                            <span>{{ "%.2f".format(result.pbr if result.pbr else 0) }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            배당수익률(%)
                            <span>{{ "%.2f".format(result.div_yield if result.div_yield else 0) }}</span>
                        </li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <ul class="list-group">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            ROE(3년 평균, %)
                            <span>{{ "%.2f".format(result.roe_avg_3y if result.roe_avg_3y else 0) }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            F-Score
                            <span>{{ result.fscore if result.fscore else 0 }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            부채비율(%)
                            <span>{{ "%.2f".format(result.debt_ratio if result.debt_ratio else 0) }}</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <strong>스크리닝 이력 (최근 30건)</strong>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-sm table-striped">
                    <thead class="thead-light">
                        <tr>
                            <th>스크리닝일</th>
                            <th>전략</th>
                            <th>통과 여부</th>
                            <th>시가총액(억)</th>
                            <th>PER</th>
                            <th>PBR</th>
                            <th>ROE(%)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in history %}
                        <tr>
                            <td>{{ item.screening_date }}</td>
                            <td><span class="badge badge-secondary">{{ item.strategy_name }}</span></td>
                            <td>
                                {% if item.passed %}
                                <span class="badge badge-success">통과</span>
                                {% else %}
                                <span class="badge badge-secondary">미통과</span>
                                {% endif %}
                            </td>
                            <td>{{ (item.market_cap / 100000000)|int|format_number }}</td>
                            <td>{{ "%.2f".format(item.per if item.per else 0) }}</td>
                            <td>{{ "%.2f".format(item.pbr if item.pbr else 0) }}</td>
                            <td>{{ "%.2f".format(item.roe_avg_3y if item.roe_avg_3y else 0) }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% else %}
    <div class="alert alert-warning">
        종목 정보를 찾을 수 없습니다.
    </div>
    {% endif %}
</div>
{% endblock %}